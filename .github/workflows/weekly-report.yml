name: "Generate Performance PDF"
on:
  schedule:
    - cron: '0 0 * * 1' # Weekly
    - cron: '0 0 1 * *' # Monthly
  workflow_dispatch:

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Generate Report and Capture Filename
        id: metadata
        run: |
          # The script prints the date range (e.g., 2025-12-22-to-2025-12-28)
          FILENAME=$(python scripts/generate_report.py)
          echo "REPORT_NAME=$FILENAME" >> $GITHUB_OUTPUT

      - name: Convert Markdown to PDF
        uses: baileyjm02/markdown-to-pdf@v1
        with:
          input_path: report.md
          # Uses the date range as the filename
          output_path: ${{ steps.metadata.outputs.REPORT_NAME }}.pdf 

      - name: Upload PDF
        uses: actions/upload-artifact@v4
        with:
          name: ${{ steps.metadata.outputs.REPORT_NAME }}
          path: ${{ steps.metadata.outputs.REPORT_NAME }}.pdf
