name: "Generate Professional Report"
on:
  schedule:
    - cron: '0 0 * * 1'
  workflow_dispatch:

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Script
        id: metadata
        run: |
          FNAME=$(python scripts/generate_report.py)
          echo "REPORT_NAME=$FNAME" >> $GITHUB_OUTPUT

      - name: Create Styling
        run: |
          echo "table { width: 100%; border-collapse: collapse; margin-bottom: 20px; } 
          th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
          th { background-color: #f4f4f4; }
          h1, h2 { color: #2c3e50; border-bottom: 2px solid #eee; }" > style.css

      - name: Markdown to PDF
        uses: baileyjm02/markdown-to-pdf@v1
        with:
          input_path: report.md
          output_dir: output_pdf
          build_pdf: true
          # Applying the style we just created
          theme: style.css 

      - name: Rename and Upload
        run: |
          sudo chown -R $USER:$USER output_pdf
          mv output_pdf/report.pdf ${{ steps.metadata.outputs.REPORT_NAME }}.pdf
          
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ${{ steps.metadata.outputs.REPORT_NAME }}
          path: ${{ steps.metadata.outputs.REPORT_NAME }}.pdf
